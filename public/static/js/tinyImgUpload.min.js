function tinyImgUpload(f,c){var g=document.querySelectorAll(f);if(g.length==0){console.log("绑定的元素不存在");return}else{if(g.length>1){console.log("请绑定唯一元素");return}else{g[0].innerHTML='<div id="img-container" ><div class="img-up-add  img-item"> <span class="img-add-icon">+</span> </div><input type="file" name="files[]" id="img-file-input" multiple></div>';var f=g[0].querySelector("#img-container");f.files=[]}}var e=document.querySelector(".img-up-add");e.addEventListener("click",function(){document.querySelector("#img-file-input").value=null;document.querySelector("#img-file-input").click();return false},false);function d(k){var n=k.target.files;for(var m=0,p;p=n[m];m++){if(!p.type.match("image.*")){continue}var o=false;for(var l=0;l<(f.files).length;l++){if((f.files)[l].name==p.name){o=true;break}}if(!o){f.files.push(p);var h=new FileReader();h.onload=(function(i){return function(q){var j=document.createElement("div");j.className="img-thumb img-item";j.innerHTML='<img class="thumb-icon" src="'+q.target.result+'" /><a href="javscript:;" class="img-remove">x</a>';f.insertBefore(j,e)}})(p);h.readAsDataURL(p)}}}document.querySelector("#img-file-input").addEventListener("change",d,false);function b(h){if(h.target.className.match(/img-remove/)){console.log("3",f.files);function j(l){if(l&&l.nodeType&&l.nodeType==1){var m=l.parentNode;var n=m.children;for(var k=0;k<n.length;k++){if(n[k]==l){return k}}}else{return -1}}var i=j(h.target.parentNode);f.removeChild(h.target.parentNode);if(i<0){return}else{f.files.splice(i,1)}console.log("4",f.files)}}f.addEventListener("click",b,false);function a(){console.log(f.files);var l=new XMLHttpRequest();var k=new FormData();for(var h=0,j;j=f.files[h];h++){k.append("files[]",j)}console.log("1",f.files);console.log("2",k);l.onreadystatechange=function(i){if(l.readyState==4){if(l.status==200){c.onSuccess(l.responseText)}else{c.onFailure(l.responseText)}}};l.open("POST",c.path,true);l.send(k)}return a};