$(function(){var a;var c={fileType:["jpg","png","bmp","jpeg"],fileSize:1024*1024*10};$(".file").change(function(){var f=$(this).attr("id");var j=document.getElementById(f);var e=$(this).parents(".aui-photo");var t=j.files;console.log(t+"======filelist=====");var q=$(this).parent();var k=[];var g=e.find(".aui-up-section").length;var r=g+t.length;if(t.length>8||r>8){alert("你好！上传图片不得超过8张，请重新选择")}else{if(g<8){t=b(t);for(var l=0;l<t.length;l++){var u=window.URL.createObjectURL(t[l]);k.push(u);var m=$("<section class='aui-up-section fl loading'>");e.prepend(m);var o=$("<span class='aui-up-span'>");o.appendTo(m);var h=$("<img class='aui-close-up-img'>").on("click",function(i){i.preventDefault();i.stopPropagation();$(".aui-works-mask").show();a=$(this).parent()});h.attr("src","http://images.669pic.com/element_min_new_pic/26/85/11/46/1c025c5a73bb6aaebc30d9794a775497.png!/fw/260/quality/90/unsharp/true/canvas/260x256/compress/true/cvscolor/ffffffff").appendTo(m);var d=$("<img class='aui-to-up-img aui-up-clarity'>");d.attr("src",k[l]);d.appendTo(m);var n=$("<p class='img-aui-img-name-p'>");n.html(t[l].name).appendTo(m);var p=$("<input id='actionId' name='actionId' value='' type='hidden'>");p.appendTo(m);var s=$("<input id='tags' name='tags' value='' type='hidden'/>");s.appendTo(m)}}}setTimeout(function(){$(".aui-up-section").removeClass("loading");$(".aui-to-up-img").removeClass("aui-up-clarity")},2100);g=e.find(".aui-up-section").length;if(g>=8){$(this).parent().hide()}$(this).val("")});$(".aui-photo").delegate(".aui-close-up-img","click",function(){$(".aui-works-mask").show();a=$(this).parent()});$(".aui-accept-ok").click(function(){$(".aui-works-mask").hide();var d=a.siblings().length;if(d<8){a.parent().find(".aui-file-up").show()}a.remove()});$(".aui-accept-no").click(function(){$(".aui-works-mask").hide()});function b(h){var j=[];for(var f=0,e;e=h[f];f++){var d=e.name.split("").reverse().join("");if(d.split(".")[0]!=null){var g=d.split(".")[0].split("").reverse().join("");console.log(g+"===type===");if(jQuery.inArray(g,c.fileType)>-1){if(e.size>=c.fileSize){alert(e.size);alert('您这个"'+e.name+'"文件大小过大')}else{j.push(e)}}else{alert('您这个"'+e.name+'"上传类型不符合')}}else{alert('您这个"'+e.name+'"没有类型, 无法识别')}}console.log(j)}});